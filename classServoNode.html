<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JetPackJoyRide: ServoNode Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">JetPackJoyRide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classServoNode-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">ServoNode Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Listens to twist message and translate them into PWM signal values that the pca driver understands.  
 <a href="classServoNode.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="ServoNode_8hpp_source.html">ServoNode.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for ServoNode:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classServoNode.png" alt=""/>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a682ac10746c48de6e77bcc7e7b53d978" id="r_a682ac10746c48de6e77bcc7e7b53d978"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classServoNode.html#a682ac10746c48de6e77bcc7e7b53d978">ServoNode</a> ()</td></tr>
<tr class="separator:a682ac10746c48de6e77bcc7e7b53d978"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77e32a9dd0719b322792fce594cabf79" id="r_a77e32a9dd0719b322792fce594cabf79"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classServoNode.html#a77e32a9dd0719b322792fce594cabf79">~ServoNode</a> () override</td></tr>
<tr class="separator:a77e32a9dd0719b322792fce594cabf79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab31e1771719caecc5b2be38c28240526" id="r_ab31e1771719caecc5b2be38c28240526"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classServoNode.html#ab31e1771719caecc5b2be38c28240526">initPCA9685</a> (std::shared_ptr&lt; <a class="el" href="classAPCA9685Driver.html">APCA9685Driver</a> &gt; mock_pca_driver=nullptr)</td></tr>
<tr class="memdesc:ab31e1771719caecc5b2be38c28240526"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the PCA9685 driver.  <br /></td></tr>
<tr class="separator:ab31e1771719caecc5b2be38c28240526"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a6477bb6a6e9ce7b682e2ba1624a40fb8" id="r_a6477bb6a6e9ce7b682e2ba1624a40fb8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classServoNode.html#a6477bb6a6e9ce7b682e2ba1624a40fb8">writeAngle</a> (geometry_msgs::msg::Twist::SharedPtr twist)</td></tr>
<tr class="memdesc:a6477bb6a6e9ce7b682e2ba1624a40fb8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles incoming direction messages and maps the angle to PCA9685 PWM counts.  <br /></td></tr>
<tr class="separator:a6477bb6a6e9ce7b682e2ba1624a40fb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:aa548a11605a08a51a4fa38809e2bafa6" id="r_aa548a11605a08a51a4fa38809e2bafa6"><td class="memItemLeft" align="right" valign="top">rclcpp::Subscription&lt; geometry_msgs::msg::Twist &gt;::SharedPtr&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classServoNode.html#aa548a11605a08a51a4fa38809e2bafa6">direction_subscriber_</a></td></tr>
<tr class="separator:aa548a11605a08a51a4fa38809e2bafa6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a4b5cf43505ee9bd33c5d2dbe2c03a3" id="r_a5a4b5cf43505ee9bd33c5d2dbe2c03a3"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="classAPCA9685Driver.html">APCA9685Driver</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classServoNode.html#a5a4b5cf43505ee9bd33c5d2dbe2c03a3">pca_driver_</a></td></tr>
<tr class="separator:a5a4b5cf43505ee9bd33c5d2dbe2c03a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60b9f59505df4974849a3cfc7f8c4096" id="r_a60b9f59505df4974849a3cfc7f8c4096"><td class="memItemLeft" align="right" valign="top">const float_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classServoNode.html#a60b9f59505df4974849a3cfc7f8c4096">MAX_ANGULAR_VEL</a> = 1.0</td></tr>
<tr class="separator:a60b9f59505df4974849a3cfc7f8c4096"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Listens to twist message and translate them into PWM signal values that the pca driver understands. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a682ac10746c48de6e77bcc7e7b53d978" name="a682ac10746c48de6e77bcc7e7b53d978"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a682ac10746c48de6e77bcc7e7b53d978">&#9670;&#160;</a></span>ServoNode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ServoNode::ServoNode </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a77e32a9dd0719b322792fce594cabf79" name="a77e32a9dd0719b322792fce594cabf79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77e32a9dd0719b322792fce594cabf79">&#9670;&#160;</a></span>~ServoNode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ServoNode::~ServoNode </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ab31e1771719caecc5b2be38c28240526" name="ab31e1771719caecc5b2be38c28240526"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab31e1771719caecc5b2be38c28240526">&#9670;&#160;</a></span>initPCA9685()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t ServoNode::initPCA9685 </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="classAPCA9685Driver.html">APCA9685Driver</a> &gt;&#160;</td>
          <td class="paramname"><em>mock_driver</em> = <code>nullptr</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the PCA9685 driver. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mock_driver</td><td>if not null, the driver will be mocked. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>EXIT_FAILURE if the driver fails to initialize, EXIT_SUCCESS otherwise. </dd></dl>

</div>
</div>
<a id="a6477bb6a6e9ce7b682e2ba1624a40fb8" name="a6477bb6a6e9ce7b682e2ba1624a40fb8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6477bb6a6e9ce7b682e2ba1624a40fb8">&#9670;&#160;</a></span>writeAngle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ServoNode::writeAngle </td>
          <td>(</td>
          <td class="paramtype">geometry_msgs::msg::Twist::SharedPtr&#160;</td>
          <td class="paramname"><em>twist</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handles incoming direction messages and maps the angle to PCA9685 PWM counts. </p>
<p>This function subscribes to a topic providing direction as an angle (0 to 180 degrees). It validates the input and calculates the corresponding pulse width for a servo motor. The PCA9685 divides the 20 ms (50 Hz) PWM period into 4096 discrete counts, where each count corresponds to approximately 4.88 microseconds. Servo motors typically require pulse widths between 1 ms (0°) and 2 ms (180°), which map to 102 and 510 counts, respectively. The pulse width is linearly interpolated using the formula: pulseWidth = MIN_COUNT + (angle * (MAX_COUNT - MIN_COUNT)) / 180 For example:</p><ul>
<li>At 0 degrees: pulseWidth = 102 counts (HIGH for ~1 ms).</li>
<li>At 180 degrees: pulseWidth = 510 counts (HIGH for ~2 ms). The <code>setPWM</code> function configures the PCA9685 as follows:</li>
<li>onTime = 0 (signal starts HIGH at the beginning of the period).</li>
<li>offTime = pulseWidth (signal goes LOW after <code>pulseWidth</code> counts).</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">twist</td><td>The incoming direction message. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="aa548a11605a08a51a4fa38809e2bafa6" name="aa548a11605a08a51a4fa38809e2bafa6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa548a11605a08a51a4fa38809e2bafa6">&#9670;&#160;</a></span>direction_subscriber_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rclcpp::Subscription&lt;geometry_msgs::msg::Twist&gt;::SharedPtr ServoNode::direction_subscriber_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a60b9f59505df4974849a3cfc7f8c4096" name="a60b9f59505df4974849a3cfc7f8c4096"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60b9f59505df4974849a3cfc7f8c4096">&#9670;&#160;</a></span>MAX_ANGULAR_VEL</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const float_t ServoNode::MAX_ANGULAR_VEL = 1.0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a5a4b5cf43505ee9bd33c5d2dbe2c03a3" name="a5a4b5cf43505ee9bd33c5d2dbe2c03a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a4b5cf43505ee9bd33c5d2dbe2c03a3">&#9670;&#160;</a></span>pca_driver_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="classAPCA9685Driver.html">APCA9685Driver</a>&gt; ServoNode::pca_driver_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>JetRacer/src/peripherals/servo_motor/include/<a class="el" href="ServoNode_8hpp_source.html">ServoNode.hpp</a></li>
<li>JetRacer/src/peripherals/servo_motor/src/<a class="el" href="ServoNode_8cpp.html">ServoNode.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
